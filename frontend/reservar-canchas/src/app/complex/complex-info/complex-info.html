<div class="complex-info-container">
  <div class="img-container">
    <img [src]="backendUrl + complex.imagePath" alt="Imagen del complejo" />
  </div>
  <div class="basicinfo-complex-container">
    <div class="name-rating-row">
      <h1 class="complex-name">{{ complex.name }}</h1>
      <ng-content select="[edit-complex-button]"></ng-content>
      <ng-content select="[delete-complex-button]"></ng-content>
      <ng-content select="[changestate-complex-button]"></ng-content>
    </div>
    @if(isAdmin){
      <div class="complex-state-container">
        <span class="state-label">Estado del complejo:</span>
        <span class="state-badge" [ngClass]="complex.state.toLowerCase()">
          {{ complex.state }}
        </span>
        <i class="pi pi-info-circle info-icon" 
            (mouseenter)="op.toggle($event)" 
            (mouseleave)="op.toggle($event)"
            style="cursor: pointer; margin-left: 8px; color: #666;">
        </i>
        <p-popover #op>
          <div class="popover-info-content">
            <h4 class="popover-title">Referencia de Estados</h4>
            <ul class="popover-list">
              <li><span class="dot pendiente"></span> <strong>Pendiente:</strong> En proceso de verificación.</li>
              <li><span class="dot habilitado"></span> <strong>Habilitado:</strong> Disponible para reservas.</li>
              <li><span class="dot deshabilitado"></span> <strong>Deshabilitado:</strong> Inactivo temporalmente. No aparece en búsquedas.</li>
              <li><span class="dot bloqueado"></span> <strong>Bloqueado:</strong> Suspendido por administración. Debes comunicarte con soporte.</li>
              <li><span class="dot rechazado"></span> <strong>Rechazado:</strong> No cumple requisitos. Puedes editarlo y enviarlo para nueva verificación.</li>
            </ul>
          </div>
        </p-popover>
      </div>
    }
    @if (complex.averageRating) {
      <div class="rating-container">
        <span class="label">Calificación:</span>

        <p-rating
          [ngModel]="complex.averageRating"
          [readonly]="true"
          iconCancelClass="hidden"
          styleClass="custom-stars"
        >
        </p-rating>

        <div class="score-badge">
          {{ complex.averageRating | number: "1.1-1" }} / 5
        </div>
      </div>
    }
    <p class="complex-description">{{ complex.description }}</p>
    <p class="complex-location">
      <i class="pi pi-map-marker"></i>
      {{ complex.street }} {{ complex.number }} - {{ complex.locality }},
      {{ complex.province }}
    </p>
    <p class="complex-phone">
      <i class="pi pi-phone"></i>
      {{ complex.phone }}
    </p>
    <div style="display: inline-flex">
      <p-message severity="info" variant="outlined">
        *Aclaración: Este complejo cobra un extra por iluminación a partir de
        las {{ complex.startIlumination.slice(0, 5) }}hs de un
        {{ complex.aditionalIlumination }}% sobre el valor base de la cancha.
      </p-message>
    </div>
  </div>
  <div style="padding: 1rem">
    <h3 style="font-size: 25px; margin-bottom: 1rem">Elegí la fecha</h3>
    <ng-content select="[calendar]"></ng-content>
  </div>
  <div style="display: flex; gap: 15px; padding: 1rem; align-items: center">
    <h3 style="font-size: 25px">
      Elegí la cancha, el horario y hace tu reserva.
    </h3>
    <ng-content select="[add-field-button]"></ng-content>
  </div>
  <app-field-table
    [fields]="fields"
    [isAdmin]="isAdmin"
    [complex]="complex"
    [selectedDate]="selectedDate"
    (editField)="onEditField($event)"
    (deleteField)="onDeleteField($event)"
    (reserveField)="onReserveField($event)"
    (recurringBlockField)="onRecurringBlockField($event)"
  >
  </app-field-table>

  <div style="padding: 1rem">
    <h3 style="font-size: 25px; margin-bottom: 1rem">Últimas reseñas</h3>
    @if (reviews.length < 3) {
      <div class="static-reviews-container">
        @for (review of reviews; track review.id) {
          <div class="static-card-wrapper">
            <app-review-card [review]="review"></app-review-card>
          </div>
        }
      </div>

    } @else {
      <p-carousel
        [value]="reviews"
        [numVisible]="3"
        [numScroll]="1"
        [circular]="true"
        [responsiveOptions]="responsiveOptions"
        [autoplayInterval]="5000"
      >
        <ng-template pTemplate="item" let-review>
          <div class="carousel-item-wrapper">
            <app-review-card [review]="review"></app-review-card>
          </div>
        </ng-template>
      </p-carousel>
    }
  </div>

  <div class="info-extra-container">
    <p-panel header="Horarios del club" [toggleable]="true">
      <div class="days-container">
        @for (timeSlot of complex.timeSlots; track timeSlot.id) {
          <p style="font-weight: 600">{{ timeSlot.weekDay }}:</p>
          <p>
            {{
              timeSlot.initTime === timeSlot.endTime
                ? "Cerrado"
                : timeSlot.initTime.slice(0, 5) +
                  " a " +
                  timeSlot.endTime.slice(0, 5)
            }}
          </p>
        }
      </div>
    </p-panel>
    <p-panel header="Servicios del club" [toggleable]="true">
      <div class="services-container">
        @for (service of complex.services; track service.id) {
          <p>{{ service.serviceDescription }}</p>
        }
      </div>
    </p-panel>
  </div>
</div>
